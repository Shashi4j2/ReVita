<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RehabAI â€” Intelligent Recovery System</title>
<link href="https://fonts.googleapis.com/css2?family=Clash+Display:wght@400;500;600;700&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<style>
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DESIGN SYSTEM
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  :root {
    --bg: #050b14;
    --bg2: #091220;
    --bg3: #0d1a2e;
    --surface: #0f2237;
    --surface2: #142b44;
    --border: rgba(0,180,255,0.12);
    --accent: #00b4ff;
    --accent2: #00ffc6;
    --accent3: #7c3aed;
    --text: #e8f4fd;
    --text2: #8bafc8;
    --text3: #4d7a99;
    --low: #22c55e;
    --moderate: #f59e0b;
    --high: #f97316;
    --critical: #ef4444;
    --font-display: 'Clash Display', sans-serif;
    --font-body: 'DM Sans', sans-serif;
    --radius: 16px;
    --radius-sm: 10px;
    --shadow: 0 24px 64px rgba(0,0,0,0.5);
    --glow: 0 0 40px rgba(0,180,255,0.15);
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  html { scroll-behavior: smooth; }

  body {
    font-family: var(--font-body);
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    overflow-x: hidden;
    line-height: 1.6;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     BACKGROUND NOISE + GRID
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image:
      linear-gradient(rgba(0,180,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,180,255,0.03) 1px, transparent 1px);
    background-size: 60px 60px;
    pointer-events: none;
    z-index: 0;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCROLL ANIMATIONS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .reveal {
    opacity: 0;
    transform: translateY(40px);
    transition: opacity 0.7s cubic-bezier(0.16,1,0.3,1), transform 0.7s cubic-bezier(0.16,1,0.3,1);
  }
  .reveal.from-left {
    transform: translateX(-60px);
  }
  .reveal.from-right {
    transform: translateX(60px);
  }
  .reveal.visible {
    opacity: 1;
    transform: translate(0);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     NAV
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  nav {
    position: fixed;
    top: 0; left: 0; right: 0;
    z-index: 100;
    padding: 16px 40px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(5,11,20,0.85);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid var(--border);
  }

  .nav-logo {
    font-family: var(--font-display);
    font-size: 22px;
    font-weight: 700;
    color: var(--text);
    display: flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
  }

  .nav-logo .pulse-dot {
    width: 10px; height: 10px;
    border-radius: 50%;
    background: var(--accent2);
    box-shadow: 0 0 12px var(--accent2);
    animation: pulse-dot 2s ease-in-out infinite;
  }

  @keyframes pulse-dot {
    0%, 100% { transform: scale(1); opacity: 1; }
    50% { transform: scale(1.5); opacity: 0.7; }
  }

  .nav-links { display: flex; gap: 6px; }
  .nav-link {
    padding: 8px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    color: var(--text2);
    transition: all 0.2s;
    border: none;
    background: none;
    font-family: var(--font-body);
  }
  .nav-link:hover, .nav-link.active {
    background: var(--surface);
    color: var(--accent);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HERO SECTION
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .hero {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    padding: 100px 40px 60px;
    position: relative;
    overflow: hidden;
  }

  .hero-orb {
    position: absolute;
    border-radius: 50%;
    filter: blur(80px);
    pointer-events: none;
  }
  .hero-orb-1 {
    width: 600px; height: 600px;
    background: radial-gradient(circle, rgba(0,180,255,0.12), transparent 70%);
    top: -200px; left: -200px;
    animation: orb-float 8s ease-in-out infinite;
  }
  .hero-orb-2 {
    width: 400px; height: 400px;
    background: radial-gradient(circle, rgba(0,255,198,0.08), transparent 70%);
    bottom: -100px; right: -100px;
    animation: orb-float 10s ease-in-out infinite reverse;
  }
  .hero-orb-3 {
    width: 300px; height: 300px;
    background: radial-gradient(circle, rgba(124,58,237,0.1), transparent 70%);
    top: 40%; left: 60%;
    animation: orb-float 12s ease-in-out infinite;
  }

  @keyframes orb-float {
    0%, 100% { transform: translate(0,0); }
    33% { transform: translate(30px,-20px); }
    66% { transform: translate(-20px,15px); }
  }

  .hero-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 6px 16px;
    background: rgba(0,180,255,0.1);
    border: 1px solid rgba(0,180,255,0.25);
    border-radius: 100px;
    font-size: 13px;
    color: var(--accent);
    margin-bottom: 28px;
    animation: fade-in-up 0.8s 0.2s both;
  }

  @keyframes fade-in-up {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .hero h1 {
    font-family: var(--font-display);
    font-size: clamp(42px, 7vw, 88px);
    font-weight: 700;
    line-height: 1.05;
    margin-bottom: 24px;
    animation: fade-in-up 0.8s 0.4s both;
  }

  .hero h1 .gradient-text {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .hero p {
    font-size: 19px;
    color: var(--text2);
    max-width: 600px;
    margin: 0 auto 48px;
    font-weight: 300;
    animation: fade-in-up 0.8s 0.6s both;
  }

  .hero-cta {
    display: flex;
    gap: 16px;
    justify-content: center;
    flex-wrap: wrap;
    animation: fade-in-up 0.8s 0.8s both;
  }

  .btn-primary {
    padding: 14px 32px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border: none;
    border-radius: 10px;
    color: #050b14;
    font-weight: 700;
    font-size: 15px;
    font-family: var(--font-body);
    cursor: pointer;
    transition: all 0.25s;
    position: relative;
    overflow: hidden;
  }
  .btn-primary::after {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(255,255,255,0.15);
    opacity: 0;
    transition: opacity 0.2s;
  }
  .btn-primary:hover::after { opacity: 1; }
  .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 12px 32px rgba(0,180,255,0.35); }

  .btn-secondary {
    padding: 14px 32px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 10px;
    color: var(--text);
    font-weight: 500;
    font-size: 15px;
    font-family: var(--font-body);
    cursor: pointer;
    transition: all 0.25s;
  }
  .btn-secondary:hover {
    border-color: var(--accent);
    color: var(--accent);
    transform: translateY(-2px);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     STATS BAR
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .stats-bar {
    display: flex;
    justify-content: center;
    gap: 0;
    padding: 20px 40px;
    border-top: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
    background: var(--bg2);
    flex-wrap: wrap;
  }
  .stat-item {
    padding: 20px 48px;
    text-align: center;
    border-right: 1px solid var(--border);
  }
  .stat-item:last-child { border-right: none; }
  .stat-number {
    font-family: var(--font-display);
    font-size: 36px;
    font-weight: 700;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .stat-label { color: var(--text3); font-size: 13px; margin-top: 4px; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     PAGES / SECTIONS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .page { display: none; }
  .page.active { display: block; }

  .section {
    max-width: 1100px;
    margin: 0 auto;
    padding: 80px 40px;
    position: relative;
    z-index: 1;
  }

  .section-header {
    margin-bottom: 48px;
  }
  .section-tag {
    display: inline-block;
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 2px;
    color: var(--accent);
    margin-bottom: 12px;
  }
  .section-title {
    font-family: var(--font-display);
    font-size: clamp(28px, 4vw, 44px);
    font-weight: 700;
    line-height: 1.15;
  }
  .section-sub {
    color: var(--text2);
    margin-top: 12px;
    font-size: 16px;
    max-width: 560px;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     CARDS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 28px;
    transition: all 0.3s;
    position: relative;
    overflow: hidden;
  }
  .card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--accent), transparent);
    opacity: 0;
    transition: opacity 0.3s;
  }
  .card:hover { border-color: rgba(0,180,255,0.3); transform: translateY(-4px); box-shadow: var(--glow); }
  .card:hover::before { opacity: 1; }

  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
  .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }
  .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }

  @media (max-width: 768px) {
    .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
    nav { padding: 12px 20px; }
    .nav-links { display: none; }
    .section { padding: 60px 20px; }
    .stat-item { padding: 16px 24px; }
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     FORMS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .form-group {
    margin-bottom: 20px;
  }
  label {
    display: block;
    font-size: 13px;
    font-weight: 500;
    color: var(--text2);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  input, select, textarea {
    width: 100%;
    padding: 12px 16px;
    background: var(--bg3);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    color: var(--text);
    font-size: 15px;
    font-family: var(--font-body);
    transition: all 0.2s;
    outline: none;
    appearance: none;
  }
  input:focus, select:focus, textarea:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(0,180,255,0.1);
  }
  select option { background: var(--bg3); }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     RANGE SLIDER
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .range-wrapper {
    position: relative;
  }
  input[type="range"] {
    padding: 0;
    height: 6px;
    border-radius: 100px;
    background: var(--surface2);
    border: none;
    cursor: pointer;
  }
  input[type="range"]::-webkit-slider-thumb {
    appearance: none;
    width: 20px; height: 20px;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 0 8px rgba(0,180,255,0.5);
    transition: transform 0.1s;
  }
  input[type="range"]::-webkit-slider-thumb:hover { transform: scale(1.2); }

  .range-labels {
    display: flex;
    justify-content: space-between;
    margin-top: 6px;
    font-size: 12px;
    color: var(--text3);
  }

  .range-value {
    display: inline-block;
    padding: 4px 12px;
    background: rgba(0,180,255,0.1);
    border-radius: 100px;
    font-size: 18px;
    font-weight: 700;
    color: var(--accent);
    font-family: var(--font-display);
    min-width: 52px;
    text-align: center;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     RISK METER
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .risk-meter-container {
    text-align: center;
    padding: 40px;
  }

  .risk-meter {
    position: relative;
    width: 220px;
    height: 110px;
    margin: 0 auto 24px;
  }

  .risk-arc-bg {
    position: absolute;
    inset: 0;
  }

  .risk-needle {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform-origin: bottom center;
    transition: transform 1.2s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  .risk-level-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 24px;
    border-radius: 100px;
    font-family: var(--font-display);
    font-size: 22px;
    font-weight: 700;
    margin-bottom: 12px;
    transition: all 0.5s;
  }

  .risk-level-badge.Low { background: rgba(34,197,94,0.15); color: #22c55e; border: 1px solid rgba(34,197,94,0.3); }
  .risk-level-badge.Moderate { background: rgba(245,158,11,0.15); color: #f59e0b; border: 1px solid rgba(245,158,11,0.3); }
  .risk-level-badge.High { background: rgba(249,115,22,0.15); color: #f97316; border: 1px solid rgba(249,115,22,0.3); }
  .risk-level-badge.Critical { background: rgba(239,68,68,0.15); color: #ef4444; border: 1px solid rgba(239,68,68,0.3); animation: critical-pulse 1s ease-in-out infinite; }

  @keyframes critical-pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(239,68,68,0.4); }
    50% { box-shadow: 0 0 0 12px rgba(239,68,68,0); }
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     RECOVERY PROGRESS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .progress-ring-container {
    display: flex;
    align-items: center;
    gap: 32px;
    padding: 24px;
  }

  .progress-ring {
    position: relative;
    width: 120px;
    height: 120px;
    flex-shrink: 0;
  }

  .progress-ring svg {
    transform: rotate(-90deg);
  }

  .progress-ring-value {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-display);
    font-size: 28px;
    font-weight: 700;
    color: var(--accent2);
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ALERTS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .alert-item {
    display: flex;
    align-items: flex-start;
    gap: 16px;
    padding: 16px 20px;
    border-radius: var(--radius-sm);
    margin-bottom: 12px;
    animation: slide-in 0.4s ease;
  }
  @keyframes slide-in {
    from { transform: translateX(-20px); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }
  .alert-item.CRITICAL { background: rgba(239,68,68,0.1); border: 1px solid rgba(239,68,68,0.3); }
  .alert-item.ESCALATION { background: rgba(249,115,22,0.1); border: 1px solid rgba(249,115,22,0.3); }
  .alert-item.FEVER_SWELLING { background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.3); }
  .alert-icon { font-size: 20px; margin-top: 2px; }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     EXERCISE CARDS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .exercise-card {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 14px 18px;
    background: var(--bg3);
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    margin-bottom: 10px;
    transition: all 0.2s;
  }
  .exercise-card:hover { border-color: rgba(0,255,198,0.3); background: rgba(0,255,198,0.04); }
  .exercise-num {
    width: 28px; height: 28px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 700;
    color: #050b14;
    flex-shrink: 0;
  }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     TOAST
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  #toast {
    position: fixed;
    bottom: 32px;
    right: 32px;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    gap: 10px;
    pointer-events: none;
  }
  .toast-msg {
    padding: 14px 20px;
    border-radius: 10px;
    font-size: 14px;
    animation: toast-in 0.4s ease, toast-out 0.4s ease 3.6s forwards;
    pointer-events: auto;
    max-width: 340px;
  }
  .toast-msg.success { background: rgba(34,197,94,0.9); color: white; }
  .toast-msg.error { background: rgba(239,68,68,0.9); color: white; }
  .toast-msg.info { background: rgba(0,180,255,0.9); color: white; }
  @keyframes toast-in { from { transform: translateX(60px); opacity:0; } to { transform: translateX(0); opacity: 1; } }
  @keyframes toast-out { from { opacity: 1; } to { opacity: 0; transform: translateX(60px); } }

  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MISC UTILITIES
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
  .tag {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 100px;
    font-size: 12px;
    font-weight: 600;
  }
  .tag-accent { background: rgba(0,180,255,0.1); color: var(--accent); }
  .tag-green { background: rgba(34,197,94,0.1); color: var(--low); }
  .divider { height: 1px; background: var(--border); margin: 32px 0; }
  .flex-between { display: flex; align-items: center; justify-content: space-between; }
  .text-sm { font-size: 13px; color: var(--text2); }
  .text-accent { color: var(--accent); }
  .text-accent2 { color: var(--accent2); }
  .font-display { font-family: var(--font-display); }
  .mt-8 { margin-top: 8px; }
  .mt-16 { margin-top: 16px; }
  .mt-24 { margin-top: 24px; }
  .mb-0 { margin-bottom: 0 !important; }
  .loading { opacity: 0.6; pointer-events: none; }

  .spinner {
    display: inline-block;
    width: 16px; height: 16px;
    border: 2px solid rgba(0,180,255,0.3);
    border-top-color: var(--accent);
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* Feature icons */
  .feature-icon {
    width: 48px; height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    margin-bottom: 16px;
  }

  /* Timeline dots */
  .timeline-item {
    display: flex;
    gap: 16px;
    margin-bottom: 20px;
    position: relative;
  }
  .timeline-dot {
    width: 12px; height: 12px;
    border-radius: 50%;
    margin-top: 5px;
    flex-shrink: 0;
    position: relative;
    z-index: 1;
  }
  .timeline-item::before {
    content: '';
    position: absolute;
    left: 5px;
    top: 16px;
    bottom: -20px;
    width: 2px;
    background: var(--border);
  }
  .timeline-item:last-child::before { display: none; }
</style>
</head>
<body>

<!-- NAV -->
<nav>
  <a class="nav-logo" href="#" onclick="showPage('home')">
    <div class="pulse-dot"></div>
    RehabAI
  </a>
  <div class="nav-links">
    <button class="nav-link active" onclick="showPage('home')">Home</button>
    <button class="nav-link" onclick="showPage('register')">Register</button>
    <button class="nav-link" onclick="showPage('track')">Daily Track</button>
    <button class="nav-link" onclick="showPage('dashboard')">Dashboard</button>
    <button class="nav-link" onclick="showPage('alerts')">Alerts</button>
    <button class="nav-link" onclick="showPage('aifeatures')" style="background:linear-gradient(135deg,rgba(0,180,255,0.15),rgba(0,255,198,0.15));border:1px solid rgba(0,255,198,0.3);color:var(--accent2)">âœ¨ AI Insights</button>
  </div>
</nav>

<!-- TOAST -->
<div id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     HOME PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-home" class="page active">
  <section class="hero">
    <div class="hero-orb hero-orb-1"></div>
    <div class="hero-orb hero-orb-2"></div>
    <div class="hero-orb hero-orb-3"></div>
    <div style="position:relative;z-index:1">
      <div class="hero-badge">âš•ï¸ AI-Powered Recovery Intelligence</div>
      <h1>
        Recover Smarter.<br>
        <span class="gradient-text">Live Healthier.</span>
      </h1>
      <p>Continuous AI monitoring for post-hospital recovery. Real-time risk prediction, personalized rehab plans, and intelligent doctor alerts.</p>
      <div class="hero-cta">
        <button class="btn-primary" onclick="showPage('register')">Start Recovery Journey â†’</button>
        <button class="btn-secondary" onclick="showPage('dashboard')">View Dashboard</button>
      </div>
    </div>
  </section>

  <div class="stats-bar">
    <div class="stat-item reveal from-left">
      <div class="stat-number">4</div>
      <div class="stat-label">Surgery Types Supported</div>
    </div>
    <div class="stat-item reveal">
      <div class="stat-number">4</div>
      <div class="stat-label">Risk Levels</div>
    </div>
    <div class="stat-item reveal">
      <div class="stat-number">AI</div>
      <div class="stat-label">Risk Prediction Engine</div>
    </div>
    <div class="stat-item reveal from-right">
      <div class="stat-number">24/7</div>
      <div class="stat-label">Intelligent Monitoring</div>
    </div>
  </div>

  <div class="section">
    <div class="section-header reveal">
      <span class="section-tag">How It Works</span>
      <h2 class="section-title">Intelligent Recovery in 3 Steps</h2>
      <p class="section-sub">No complex setup. Start in minutes, recover with confidence.</p>
    </div>

    <div class="grid-3">
      <div class="card reveal from-left">
        <div class="feature-icon" style="background:rgba(0,180,255,0.1)">ğŸ¥</div>
        <h3 class="font-display" style="font-size:20px;margin-bottom:10px">1. Register & Onboard</h3>
        <p class="text-sm">Enter your surgery type, date, and recovery details. Our AI immediately generates your personalized profile.</p>
      </div>
      <div class="card reveal" style="transition-delay:0.1s">
        <div class="feature-icon" style="background:rgba(0,255,198,0.1)">ğŸ“Š</div>
        <h3 class="font-display" style="font-size:20px;margin-bottom:10px">2. Track Daily</h3>
        <p class="text-sm">Log pain, swelling, fever, and mobility every day. Takes less than 2 minutes.</p>
      </div>
      <div class="card reveal from-right" style="transition-delay:0.2s">
        <div class="feature-icon" style="background:rgba(124,58,237,0.1)">ğŸ§ </div>
        <h3 class="font-display" style="font-size:20px;margin-bottom:10px">3. Get AI Guidance</h3>
        <p class="text-sm">Receive risk predictions, rehab exercises, and automatic alerts to your doctor if complications arise.</p>
      </div>
    </div>

    <div class="divider"></div>

    <div class="section-header reveal">
      <span class="section-tag">Risk Intelligence</span>
      <h2 class="section-title">4-Level Risk Classification</h2>
    </div>

    <div class="grid-4">
      <div class="card reveal from-left" style="border-top:3px solid var(--low)">
        <div style="color:var(--low);font-size:28px;margin-bottom:10px">âœ…</div>
        <h4 class="font-display">Low Risk</h4>
        <p class="text-sm mt-8">Recovery on track. Continue prescribed rehab program.</p>
      </div>
      <div class="card reveal" style="border-top:3px solid var(--moderate);transition-delay:0.1s">
        <div style="color:var(--moderate);font-size:28px;margin-bottom:10px">âš ï¸</div>
        <h4 class="font-display">Moderate Risk</h4>
        <p class="text-sm mt-8">Watch closely. Modify exercises, increase monitoring frequency.</p>
      </div>
      <div class="card reveal" style="border-top:3px solid var(--high);transition-delay:0.2s">
        <div style="color:var(--high);font-size:28px;margin-bottom:10px">ğŸ”¶</div>
        <h4 class="font-display">High Risk</h4>
        <p class="text-sm mt-8">Contact your doctor. Possible complication developing.</p>
      </div>
      <div class="card reveal from-right" style="border-top:3px solid var(--critical);transition-delay:0.3s">
        <div style="color:var(--critical);font-size:28px;margin-bottom:10px">ğŸš¨</div>
        <h4 class="font-display">Critical Risk</h4>
        <p class="text-sm mt-8">Immediate medical attention. Doctor alert auto-triggered.</p>
      </div>
    </div>

    <div class="divider"></div>

    <div class="grid-2" style="align-items:center;gap:60px">
      <div class="reveal from-left">
        <span class="section-tag">Alert System</span>
        <h2 class="section-title" style="font-size:36px">Intelligent Early Warning</h2>
        <p style="color:var(--text2);margin:16px 0 24px">The AI continuously analyzes your recovery data and triggers alerts before complications become serious.</p>
        <div class="timeline-item">
          <div class="timeline-dot" style="background:var(--critical)"></div>
          <div><strong>Critical Risk</strong><p class="text-sm">Immediate doctor notification auto-sent</p></div>
        </div>
        <div class="timeline-item">
          <div class="timeline-dot" style="background:var(--high)"></div>
          <div><strong>3-Day Pain Escalation</strong><p class="text-sm">Triggered when pain increases 3 days in a row</p></div>
        </div>
        <div class="timeline-item">
          <div class="timeline-dot" style="background:var(--moderate)"></div>
          <div><strong>Fever + Swelling</strong><p class="text-sm">Possible infection flag â€” contact doctor today</p></div>
        </div>
      </div>
      <div class="reveal from-right">
        <div class="card" style="padding:32px">
          <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px">
            <div style="width:10px;height:10px;border-radius:50%;background:var(--critical);box-shadow:0 0 12px var(--critical)"></div>
            <span class="font-display">Live Alert Feed</span>
          </div>
          <div class="alert-item CRITICAL">
            <span class="alert-icon">ğŸš¨</span>
            <div><strong>Critical alert</strong><p class="text-sm">Patient John D. â€” Critical risk detected. Fever 103.2Â°F + wound discharge.</p></div>
          </div>
          <div class="alert-item ESCALATION">
            <span class="alert-icon">âš ï¸</span>
            <div><strong>Pain escalating</strong><p class="text-sm">Patient Sarah M. â€” Pain has increased for 3 consecutive days.</p></div>
          </div>
          <div class="alert-item FEVER_SWELLING">
            <span class="alert-icon">ğŸŒ¡ï¸</span>
            <div><strong>Fever + Swelling</strong><p class="text-sm">Patient Raj K. â€” 100.8Â°F with moderate swelling.</p></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     REGISTER PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-register" class="page">
  <div class="section">
    <div class="section-header reveal">
      <span class="section-tag">Onboarding</span>
      <h2 class="section-title">Register Patient</h2>
      <p class="section-sub">Create a recovery profile to begin AI-monitored rehabilitation.</p>
    </div>
    <div class="grid-2" style="gap:40px;align-items:start">
      <div class="reveal from-left">
        <div class="card">
          <h3 class="font-display" style="font-size:20px;margin-bottom:24px">Patient Information</h3>
          <div class="form-group">
            <label>Full Name</label>
            <input type="text" id="reg-name" placeholder="e.g. John Doe">
          </div>
          <div class="form-group">
            <label>Age</label>
            <input type="number" id="reg-age" placeholder="35" min="1" max="120">
          </div>
          <div class="form-group">
            <label>Surgery / Condition Type</label>
            <select id="reg-surgery">
              <option value="">Select type...</option>
              <option value="Minor Surgery">Minor Surgery</option>
              <option value="Orthopedic Surgery">Orthopedic Surgery</option>
              <option value="General Discharge">General Discharge</option>
              <option value="Injury Recovery">Injury Recovery</option>
              <option value="Stroke Rehab">Stroke Rehabilitation</option>
            </select>
          </div>
          <div class="form-group">
            <label>Surgery / Discharge Date</label>
            <input type="date" id="reg-date">
          </div>
          <div class="form-group">
            <label>Attending Doctor Name</label>
            <input type="text" id="reg-doctor" placeholder="Dr. Sharma">
          </div>
          <div class="form-group mb-0">
            <label>Doctor Email (for alerts)</label>
            <input type="email" id="reg-email" placeholder="doctor@hospital.com">
          </div>
        </div>
      </div>
      <div class="reveal from-right">
        <div class="card" style="margin-bottom:24px">
          <h3 class="font-display" style="font-size:20px;margin-bottom:24px">Physical Profile</h3>
          <div class="form-group">
            <label>Weight (kg)</label>
            <input type="number" id="reg-weight" placeholder="70" min="20" max="300">
          </div>
          <div class="form-group mb-0">
            <label>Height (cm)</label>
            <input type="number" id="reg-height" placeholder="170" min="50" max="250">
          </div>
        </div>
        <div class="card" style="background:rgba(0,180,255,0.05);border-color:rgba(0,180,255,0.2)">
          <h4 class="font-display" style="margin-bottom:16px">What happens after registration?</h4>
          <div class="timeline-item">
            <div class="timeline-dot" style="background:var(--accent)"></div>
            <div class="text-sm">AI generates your personalized recovery profile</div>
          </div>
          <div class="timeline-item">
            <div class="timeline-dot" style="background:var(--accent2)"></div>
            <div class="text-sm">Surgery-specific rehab plan is prepared</div>
          </div>
          <div class="timeline-item" style="margin-bottom:0">
            <div class="timeline-dot" style="background:var(--accent3)"></div>
            <div class="text-sm">Daily tracking begins â€” log symptoms each day</div>
          </div>
        </div>
        <button class="btn-primary" style="width:100%;margin-top:24px;padding:16px" onclick="registerPatient()" id="reg-btn">
          Register & Begin Recovery â†’
        </button>
        <p class="text-sm" style="text-align:center;margin-top:12px">Patient ID will be generated automatically</p>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DAILY TRACK PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-track" class="page">
  <div class="section">
    <div class="section-header reveal">
      <span class="section-tag">Daily Check-In</span>
      <h2 class="section-title">Log Today's Symptoms</h2>
      <p class="section-sub">Takes 2 minutes. Keeps your recovery on track.</p>
    </div>

    <div class="grid-2" style="gap:40px;align-items:start">
      <div>
        <div class="card reveal from-left" style="margin-bottom:24px">
          <div class="form-group">
            <label>Patient ID</label>
            <div style="display:flex;gap:10px">
              <input type="text" id="track-pid" placeholder="e.g. a1b2c3d4">
              <button class="btn-secondary" style="white-space:nowrap;padding:12px 20px" onclick="loadPatientInfo()">Load</button>
            </div>
          </div>
          <div id="patient-info-display" style="display:none;padding:12px;background:var(--bg3);border-radius:var(--radius-sm);border:1px solid rgba(0,255,198,0.2)">
            <div style="color:var(--accent2);font-weight:600" id="pi-name">â€”</div>
            <div class="text-sm" id="pi-details">â€”</div>
          </div>
        </div>

        <div class="card reveal from-left" style="transition-delay:0.1s;margin-bottom:24px">
          <h3 class="font-display" style="font-size:18px;margin-bottom:20px">Pain & Symptoms</h3>
          
          <div class="form-group">
            <div class="flex-between" style="margin-bottom:8px">
              <label style="margin:0">Pain Score</label>
              <span class="range-value" id="pain-val">5</span>
            </div>
            <input type="range" id="pain-score" min="0" max="10" value="5" oninput="updateRange('pain-val', this.value)">
            <div class="range-labels"><span>0 â€” No Pain</span><span>10 â€” Unbearable</span></div>
          </div>

          <div class="form-group">
            <div class="flex-between" style="margin-bottom:8px">
              <label style="margin:0">Mobility Score</label>
              <span class="range-value" id="mob-val">5</span>
            </div>
            <input type="range" id="mobility" min="0" max="10" value="5" oninput="updateRange('mob-val', this.value)">
            <div class="range-labels"><span>0 â€” Bedridden</span><span>10 â€” Full Mobility</span></div>
          </div>

          <div class="form-group">
            <div class="flex-between" style="margin-bottom:8px">
              <label style="margin:0">Medication Adherence</label>
              <span class="range-value" id="med-val">8</span>
            </div>
            <input type="range" id="medication" min="0" max="10" value="8" oninput="updateRange('med-val', this.value)">
            <div class="range-labels"><span>0 â€” Not taken</span><span>10 â€” All doses</span></div>
          </div>
        </div>

        <div class="card reveal from-left" style="transition-delay:0.2s">
          <h3 class="font-display" style="font-size:18px;margin-bottom:20px">Vital Signs & Observations</h3>
          
          <div class="grid-2">
            <div class="form-group">
              <label>Body Temperature (Â°F)</label>
              <input type="number" id="fever" value="98.6" step="0.1" min="95" max="108">
            </div>
            <div class="form-group">
              <label>Swelling Level</label>
              <select id="swelling">
                <option>None</option>
                <option>Mild</option>
                <option>Moderate</option>
                <option>Severe</option>
              </select>
            </div>
          </div>

          <div class="grid-2">
            <div class="form-group">
              <label>Wound / Incision Status</label>
              <select id="wound">
                <option value="Clean/Healing">Clean / Healing</option>
                <option value="Redness">Redness</option>
                <option value="Discharge/Open">Discharge / Open</option>
              </select>
            </div>
            <div class="form-group">
              <label>Pain Trend (vs yesterday)</label>
              <select id="pain-trend">
                <option value="Stable">Stable</option>
                <option value="Improving">Improving â†‘</option>
                <option value="Worsening">Worsening â†“</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Notes (optional)</label>
            <textarea id="notes" rows="2" placeholder="Any other symptoms or observations..."></textarea>
          </div>

          <button class="btn-primary" style="width:100%;padding:16px;font-size:16px" onclick="submitDailyLog()" id="submit-btn">
            Analyze & Get Risk Assessment â†’
          </button>
        </div>
      </div>

      <!-- Results Panel -->
      <div>
        <div class="card reveal from-right" id="result-panel" style="display:none">
          <!-- Risk Meter -->
          <div class="risk-meter-container">
            <div class="risk-meter">
              <canvas id="risk-arc" width="220" height="120"></canvas>
              <div class="risk-needle" id="risk-needle-wrap" style="transform:rotate(-90deg)">
                <svg width="4" height="90" viewBox="0 0 4 90">
                  <rect x="0" y="5" width="4" height="80" rx="2"
                    fill="url(#needleGrad)"/>
                  <defs>
                    <linearGradient id="needleGrad" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="0%" stop-color="#ffffff"/>
                      <stop offset="100%" stop-color="rgba(255,255,255,0)"/>
                    </linearGradient>
                  </defs>
                </svg>
              </div>
            </div>
            <div id="risk-level-badge" class="risk-level-badge Low">âœ… Low Risk</div>
            <div id="risk-confidence" class="text-sm">Confidence: â€”</div>
          </div>

          <div class="divider"></div>

          <!-- Recovery Score -->
          <div class="progress-ring-container">
            <div class="progress-ring">
              <svg width="120" height="120">
                <circle cx="60" cy="60" r="50" fill="none" stroke="rgba(0,180,255,0.1)" stroke-width="10"/>
                <circle id="progress-circle" cx="60" cy="60" r="50" fill="none" 
                  stroke="url(#progGrad)" stroke-width="10"
                  stroke-dasharray="314" stroke-dashoffset="314"
                  stroke-linecap="round"
                  style="transition:stroke-dashoffset 1.2s cubic-bezier(0.34,1.56,0.64,1)"/>
                <defs>
                  <linearGradient id="progGrad" x1="0" y1="0" x2="1" y2="1">
                    <stop offset="0%" stop-color="#00b4ff"/>
                    <stop offset="100%" stop-color="#00ffc6"/>
                  </linearGradient>
                </defs>
              </svg>
              <div class="progress-ring-value" id="recovery-score-val">0%</div>
            </div>
            <div>
              <div class="text-sm">Recovery Progress Score</div>
              <div class="font-display" style="font-size:22px;margin-top:4px" id="recovery-phase">â€”</div>
              <div class="text-sm mt-8" id="phase-note">â€”</div>
            </div>
          </div>

          <div class="divider"></div>

          <!-- Risk Probabilities -->
          <h4 class="font-display" style="margin-bottom:16px">Risk Distribution</h4>
          <div id="prob-bars"></div>
        </div>

        <div class="card reveal from-right" id="rehab-panel" style="display:none;margin-top:24px;transition-delay:0.15s">
          <div class="flex-between" style="margin-bottom:20px">
            <h3 class="font-display" style="font-size:18px">Rehab Plan</h3>
            <span class="tag tag-accent" id="rehab-phase-tag">â€”</span>
          </div>
          <div id="exercise-list"></div>
          <div class="divider"></div>
          <h4 class="font-display" style="margin-bottom:12px;font-size:15px">Restrictions</h4>
          <div id="restriction-list"></div>
          <div class="divider"></div>
          <div style="padding:12px 16px;background:rgba(0,255,198,0.05);border-radius:var(--radius-sm);border:1px solid rgba(0,255,198,0.15)">
            <span class="text-sm">ğŸ¯ Goal: </span>
            <span class="text-sm text-accent2" id="rehab-goal">â€”</span>
          </div>
        </div>

        <div id="alert-panel" style="display:none;margin-top:24px"></div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     DASHBOARD PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-dashboard" class="page">
  <div class="section">
    <div class="section-header reveal">
      <span class="section-tag">Recovery Dashboard</span>
      <h2 class="section-title">Patient Analytics</h2>
    </div>
    <div style="display:flex;gap:12px;margin-bottom:32px" class="reveal">
      <input type="text" id="dash-pid" placeholder="Enter Patient ID" style="max-width:300px">
      <button class="btn-primary" onclick="loadDashboard()">Load Dashboard â†’</button>
    </div>

    <div id="dashboard-content" style="display:none">
      <!-- Stat cards -->
      <div class="grid-4" style="margin-bottom:32px">
        <div class="card reveal from-left" style="text-align:center">
          <div class="text-sm">Days in Recovery</div>
          <div class="font-display" style="font-size:40px;margin-top:8px" id="d-days">â€”</div>
        </div>
        <div class="card reveal" style="text-align:center;transition-delay:0.1s">
          <div class="text-sm">Logs Submitted</div>
          <div class="font-display" style="font-size:40px;margin-top:8px" id="d-logs">â€”</div>
        </div>
        <div class="card reveal" style="text-align:center;transition-delay:0.2s">
          <div class="text-sm">Recovery Score</div>
          <div class="font-display" style="font-size:40px;margin-top:8px;background:linear-gradient(135deg,#00b4ff,#00ffc6);-webkit-background-clip:text;-webkit-text-fill-color:transparent" id="d-score">â€”</div>
        </div>
        <div class="card reveal from-right" style="text-align:center;transition-delay:0.3s">
          <div class="text-sm">Current Risk</div>
          <div class="font-display" style="font-size:32px;margin-top:8px" id="d-risk">â€”</div>
        </div>
      </div>

      <!-- Charts -->
      <div class="grid-2" style="margin-bottom:32px">
        <div class="card reveal from-left">
          <h3 class="font-display" style="font-size:18px;margin-bottom:20px">Pain Score Trend</h3>
          <canvas id="pain-chart" height="200"></canvas>
        </div>
        <div class="card reveal from-right">
          <h3 class="font-display" style="font-size:18px;margin-bottom:20px">Mobility Progress</h3>
          <canvas id="mobility-chart" height="200"></canvas>
        </div>
      </div>

      <div class="card reveal">
        <h3 class="font-display" style="font-size:18px;margin-bottom:20px">Risk Level History (Last 7 Days)</h3>
        <canvas id="risk-chart" height="120"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ALERTS PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-alerts" class="page">
  <div class="section">
    <div class="section-header reveal">
      <span class="section-tag">Doctor Alerts</span>
      <h2 class="section-title">Active Alert Feed</h2>
      <p class="section-sub">All triggered alerts across all patients.</p>
    </div>
    <div class="card reveal">
      <div class="flex-between" style="margin-bottom:24px">
        <div class="font-display" style="font-size:18px">âš¡ Live Alerts</div>
        <button class="btn-secondary" style="padding:8px 16px;font-size:13px" onclick="loadAlerts()">â†» Refresh</button>
      </div>
      <div id="alerts-list">
        <div style="text-align:center;padding:48px;color:var(--text3)">Loading alerts...</div>
      </div>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const API = "http://localhost:8000";

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  document.querySelectorAll('.nav-link').forEach(l => {
    if (l.textContent.toLowerCase().includes(id === 'home' ? 'home' : id)) l.classList.add('active');
  });
  window.scrollTo({top:0, behavior:'smooth'});
  setTimeout(initScrollReveal, 100);
  if (id === 'alerts') loadAlerts();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCROLL REVEAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function initScrollReveal() {
  const els = document.querySelectorAll('.reveal:not(.visible)');
  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry, i) => {
      if (entry.isIntersecting) {
        entry.target.style.transitionDelay = entry.target.style.transitionDelay || '0s';
        entry.target.classList.add('visible');
      }
    });
  }, { threshold: 0.1, rootMargin: '0px 0px -40px 0px' });
  els.forEach(el => observer.observe(el));
}

window.addEventListener('scroll', initScrollReveal);
window.addEventListener('load', () => { setTimeout(initScrollReveal, 200); });

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RANGE DISPLAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateRange(id, val) {
  document.getElementById(id).textContent = val;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg, type='info') {
  const el = document.createElement('div');
  el.className = `toast-msg ${type}`;
  el.textContent = msg;
  document.getElementById('toast').appendChild(el);
  setTimeout(() => el.remove(), 4000);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REGISTER PATIENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function registerPatient() {
  const name = document.getElementById('reg-name').value.trim();
  const age = document.getElementById('reg-age').value;
  const surgery = document.getElementById('reg-surgery').value;
  const date = document.getElementById('reg-date').value;
  const doctor = document.getElementById('reg-doctor').value.trim();
  const email = document.getElementById('reg-email').value.trim();
  const weight = document.getElementById('reg-weight').value || 70;
  const height = document.getElementById('reg-height').value || 170;

  if (!name || !age || !surgery || !date || !doctor) {
    toast('Please fill all required fields', 'error'); return;
  }

  const btn = document.getElementById('reg-btn');
  btn.innerHTML = '<span class="spinner"></span> Registering...';
  btn.classList.add('loading');

  try {
    const res = await fetch(`${API}/patient/register`, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({
        name, age: parseInt(age), surgery_type: surgery,
        surgery_date: date, doctor_name: doctor,
        doctor_email: email, weight_kg: parseFloat(weight),
        height_cm: parseFloat(height)
      })
    });
    const data = await res.json();
    toast(`âœ… Registered! Patient ID: ${data.patient_id}`, 'success');
    localStorage.setItem('lastPatientId', data.patient_id);
    setTimeout(() => {
      document.getElementById('track-pid').value = data.patient_id;
      showPage('track');
    }, 1500);
  } catch(e) {
    toast('âš ï¸ Could not connect to backend. Running in demo mode.', 'info');
    const demoId = Math.random().toString(36).substr(2,8);
    localStorage.setItem('lastPatientId', demoId);
    document.getElementById('track-pid').value = demoId;
    setTimeout(() => showPage('track'), 1000);
  } finally {
    btn.innerHTML = 'Register & Begin Recovery â†’';
    btn.classList.remove('loading');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOAD PATIENT INFO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadPatientInfo() {
  const pid = document.getElementById('track-pid').value.trim();
  if (!pid) return;
  try {
    const res = await fetch(`${API}/patient/${pid}`);
    const p = await res.json();
    document.getElementById('patient-info-display').style.display = 'block';
    document.getElementById('pi-name').textContent = `${p.name} Â· Age ${p.age}`;
    const surgery = p.surgery_date;
    const days = Math.floor((Date.now() - new Date(surgery)) / 86400000);
    document.getElementById('pi-details').textContent = `${p.surgery_type} Â· Day ${days} of recovery Â· Dr. ${p.doctor_name}`;
    toast(`Loaded: ${p.name}`, 'success');
  } catch(e) {
    document.getElementById('patient-info-display').style.display = 'block';
    document.getElementById('pi-name').textContent = 'Demo Patient Â· Age 42';
    document.getElementById('pi-details').textContent = 'Orthopedic Surgery Â· Day 12 of recovery Â· Dr. Smith';
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SUBMIT DAILY LOG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function submitDailyLog() {
  const pid = document.getElementById('track-pid').value.trim();
  if (!pid) { toast('Please enter Patient ID first', 'error'); return; }

  const payload = {
    patient_id: pid,
    pain_score: parseInt(document.getElementById('pain-score').value),
    swelling: document.getElementById('swelling').value,
    fever: parseFloat(document.getElementById('fever').value),
    mobility: parseInt(document.getElementById('mobility').value),
    wound_status: document.getElementById('wound').value,
    medication_adherence: parseInt(document.getElementById('medication').value),
    pain_trend: document.getElementById('pain-trend').value,
    notes: document.getElementById('notes').value
  };

  const btn = document.getElementById('submit-btn');
  btn.innerHTML = '<span class="spinner"></span> Analyzing...';
  btn.classList.add('loading');

  try {
    const res = await fetch(`${API}/log/daily`, {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    displayResults(data);
    toast('âœ… Daily log submitted and analyzed!', 'success');
  } catch(e) {
    // Demo mode â€” simulate response
    const demoResult = simulateRiskResult(payload);
    displayResults(demoResult);
    toast('âš¡ Demo mode â€” showing simulated results', 'info');
  } finally {
    btn.innerHTML = 'Analyze & Get Risk Assessment â†’';
    btn.classList.remove('loading');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SIMULATE RESULT (demo mode)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function simulateRiskResult(payload) {
  const pain = payload.pain_score;
  const fever = payload.fever;
  const swelling = payload.swelling;
  
  let riskIdx = 0;
  if (fever >= 101.5 || payload.wound_status === 'Discharge/Open') riskIdx = 3;
  else if (pain >= 8 || swelling === 'Severe') riskIdx = 2;
  else if (pain >= 6 || swelling === 'Moderate' || fever >= 100.4) riskIdx = 1;

  const labels = ['Low','Moderate','High','Critical'];
  const riskLevel = labels[riskIdx];
  
  const exercises = {
    'Low': ['Deep breathing exercises â€” 10 reps Ã— 3 sets','Gentle ankle circles â€” 15 reps','Short walks (5-10 min) twice daily'],
    'Moderate': ['Bed-based breathing exercises only','Gentle foot pumps â€” 20 reps hourly'],
    'High': ['Rest only â€” consult physiotherapist before any exercise'],
    'Critical': ['STOP all exercise â€” seek emergency medical attention']
  };
  const restrictions = {
    'Low': ['Avoid heavy lifting > 5kg','No strenuous activity'],
    'Moderate': ['Rest primarily','Elevate affected area','Ice packs 20min every 2hrs'],
    'High': ['Strict rest','No movement without guidance'],
    'Critical': ['Immediate medical consultation required']
  };
  const goals = {
    'Low': 'Regain baseline mobility within 1â€“2 weeks',
    'Moderate': 'Reduce inflammation before progressing',
    'High': 'Stabilize condition â€” contact your doctor',
    'Critical': 'Emergency evaluation needed'
  };

  const probs = [0.1,0.1,0.1,0.1];
  probs[riskIdx] = 0.7;
  const remaining = 0.3 / 3;
  probs.forEach((_,i) => { if(i!==riskIdx) probs[i] = remaining; });

  return {
    risk: {
      risk_level: riskLevel, risk_index: riskIdx,
      confidence: 70 + Math.random()*20,
      color: ['#22c55e','#f59e0b','#f97316','#ef4444'][riskIdx],
      probabilities: { Low: Math.round(probs[0]*100), Moderate: Math.round(probs[1]*100), High: Math.round(probs[2]*100), Critical: Math.round(probs[3]*100) }
    },
    rehab_plan: {
      exercises: exercises[riskLevel],
      restrictions: restrictions[riskLevel],
      goals: goals[riskLevel],
      recovery_phase: 'Sub-Acute Phase (Days 8â€“21)',
      phase_note: 'Begin progressive strengthening. Gentle exercises allowed.'
    },
    recovery_score: Math.max(10, 70 - pain*4 + (10-pain)*2),
    alerts_triggered: fever>=100.4 && swelling==='Moderate' ? [{type:'FEVER_SWELLING',message:`ğŸŒ¡ï¸ Fever + Swelling detected. Contact doctor.`}] : []
  };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DISPLAY RESULTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function displayResults(data) {
  const { risk, rehab_plan, recovery_score, alerts_triggered } = data;
  
  // Show panels
  document.getElementById('result-panel').style.display = 'block';
  document.getElementById('rehab-panel').style.display = 'block';
  
  // â”€â”€ Risk Meter â”€â”€
  drawRiskArc(document.getElementById('risk-arc'));
  const angles = { Low: -60, Moderate: -20, High: 20, Critical: 60 };
  const angle = angles[risk.risk_level] || -60;
  document.getElementById('risk-needle-wrap').style.transform = `rotate(${angle}deg)`;
  
  const badge = document.getElementById('risk-level-badge');
  const icons = { Low:'âœ…', Moderate:'âš ï¸', High:'ğŸ”¶', Critical:'ğŸš¨' };
  badge.className = `risk-level-badge ${risk.risk_level}`;
  badge.textContent = `${icons[risk.risk_level]} ${risk.risk_level} Risk`;
  document.getElementById('risk-confidence').textContent = `Confidence: ${Math.round(risk.confidence)}%`;

  // â”€â”€ Recovery Score â”€â”€
  const score = Math.round(recovery_score);
  const circle = document.getElementById('progress-circle');
  const circumference = 314;
  circle.style.strokeDashoffset = circumference - (score / 100) * circumference;
  document.getElementById('recovery-score-val').textContent = score + '%';
  document.getElementById('recovery-phase').textContent = rehab_plan.recovery_phase || '';
  document.getElementById('phase-note').textContent = rehab_plan.phase_note || '';

  // â”€â”€ Prob Bars â”€â”€
  const probContainer = document.getElementById('prob-bars');
  probContainer.innerHTML = '';
  const colors = { Low:'#22c55e', Moderate:'#f59e0b', High:'#f97316', Critical:'#ef4444' };
  Object.entries(risk.probabilities).forEach(([label, pct]) => {
    probContainer.innerHTML += `
      <div style="margin-bottom:10px">
        <div class="flex-between text-sm" style="margin-bottom:4px">
          <span style="color:${colors[label]}">${label}</span>
          <span>${pct}%</span>
        </div>
        <div style="height:6px;background:var(--surface2);border-radius:100px;overflow:hidden">
          <div style="height:100%;width:${pct}%;background:${colors[label]};border-radius:100px;transition:width 1s ease;"></div>
        </div>
      </div>`;
  });

  // â”€â”€ Exercises â”€â”€
  const exList = document.getElementById('exercise-list');
  exList.innerHTML = (rehab_plan.exercises || []).map((ex, i) => `
    <div class="exercise-card">
      <div class="exercise-num">${i+1}</div>
      <div class="text-sm">${ex}</div>
    </div>`).join('');

  // â”€â”€ Restrictions â”€â”€
  document.getElementById('restriction-list').innerHTML = (rehab_plan.restrictions || []).map(r => `
    <div style="display:flex;gap:8px;margin-bottom:8px;align-items:center">
      <span style="color:var(--high)">âš¡</span>
      <span class="text-sm">${r}</span>
    </div>`).join('');
  
  document.getElementById('rehab-goal').textContent = rehab_plan.goals || '';
  document.getElementById('rehab-phase-tag').textContent = rehab_plan.recovery_phase || '';

  // â”€â”€ Alerts â”€â”€
  const alertPanel = document.getElementById('alert-panel');
  if (alerts_triggered && alerts_triggered.length > 0) {
    alertPanel.style.display = 'block';
    alertPanel.innerHTML = `<div class="card" style="border-color:rgba(239,68,68,0.3)">
      <h3 class="font-display" style="font-size:18px;margin-bottom:16px;color:var(--critical)">âš¡ Alerts Triggered</h3>
      ${alerts_triggered.map(a => `
        <div class="alert-item ${a.type}">
          <span class="alert-icon">ğŸš¨</span>
          <div class="text-sm">${a.message}</div>
        </div>`).join('')}
    </div>`;
  } else {
    alertPanel.style.display = 'none';
  }

  // Scroll to results
  document.getElementById('result-panel').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DRAW RISK ARC (Canvas)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function drawRiskArc(canvas) {
  const ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, 220, 120);
  const cx = 110, cy = 110, r = 90;
  const segments = [
    { color:'#22c55e', from: Math.PI, to: Math.PI*1.25 },
    { color:'#f59e0b', from: Math.PI*1.25, to: Math.PI*1.5 },
    { color:'#f97316', from: Math.PI*1.5, to: Math.PI*1.75 },
    { color:'#ef4444', from: Math.PI*1.75, to: Math.PI*2 }
  ];
  segments.forEach(s => {
    ctx.beginPath();
    ctx.arc(cx, cy, r, s.from, s.to);
    ctx.strokeStyle = s.color;
    ctx.lineWidth = 16;
    ctx.stroke();
  });
  // Tick marks
  ctx.strokeStyle = 'rgba(255,255,255,0.1)';
  ctx.lineWidth = 2;
  for(let i=0;i<=4;i++){
    const a = Math.PI + (Math.PI/4)*i;
    ctx.beginPath();
    ctx.moveTo(cx+Math.cos(a)*(r-12), cy+Math.sin(a)*(r-12));
    ctx.lineTo(cx+Math.cos(a)*(r+4), cy+Math.sin(a)*(r+4));
    ctx.stroke();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadDashboard() {
  const pid = document.getElementById('dash-pid').value.trim();
  if (!pid) { toast('Enter Patient ID', 'error'); return; }

  try {
    const [dashRes, logsRes] = await Promise.all([
      fetch(`${API}/dashboard/${pid}`),
      fetch(`${API}/logs/${pid}`)
    ]);
    const dash = await dashRes.json();
    const logsData = await logsRes.json();
    renderDashboard(dash, logsData.logs);
  } catch(e) {
    // Demo mode
    renderDashboard(demoDashboard(), demoLogs());
    toast('âš¡ Demo mode â€” showing sample data', 'info');
  }
}

function demoDashboard() {
  return {
    patient: { name:'Demo Patient', surgery_type:'Orthopedic Surgery', surgery_date: new Date(Date.now()-12*86400000).toISOString().split('T')[0] },
    total_logs: 7, recovery_score: 62, latest_risk: 'Moderate', latest_risk_index: 1
  };
}

function demoLogs() {
  return Array.from({length:7}, (_,i) => ({
    date: new Date(Date.now()-((6-i)*86400000)).toISOString().split('T')[0],
    pain_score: [8,7,7,6,6,5,4][i],
    mobility: [3,4,4,5,6,6,7][i],
    risk_level: ['High','High','Moderate','Moderate','Moderate','Low','Low'][i],
    risk_index: [2,2,1,1,1,0,0][i]
  }));
}

function renderDashboard(dash, logs) {
  document.getElementById('dashboard-content').style.display = 'block';
  
  const surgDate = new Date(dash.patient.surgery_date);
  const days = Math.floor((Date.now()-surgDate)/86400000);
  
  document.getElementById('d-days').textContent = days;
  document.getElementById('d-logs').textContent = dash.total_logs;
  document.getElementById('d-score').textContent = Math.round(dash.recovery_score) + '%';
  const riskColors = { Low:'#22c55e', Moderate:'#f59e0b', High:'#f97316', Critical:'#ef4444' };
  const riskEl = document.getElementById('d-risk');
  riskEl.textContent = dash.latest_risk;
  riskEl.style.color = riskColors[dash.latest_risk] || '#fff';

  const labels = logs.map(l => l.date || '');

  // Pain Chart
  renderLine('pain-chart', labels, logs.map(l=>l.pain_score), 'Pain Score', '#ef4444', 0, 10);
  // Mobility Chart
  renderLine('mobility-chart', labels, logs.map(l=>l.mobility), 'Mobility Score', '#22c55e', 0, 10);
  // Risk Chart
  renderRiskHistory('risk-chart', labels, logs.map(l=>l.risk_index));

  // Scroll
  document.getElementById('dashboard-content').scrollIntoView({behavior:'smooth'});
  setTimeout(initScrollReveal, 100);
}

let chartInstances = {};

function renderLine(id, labels, data, label, color, yMin, yMax) {
  const ctx = document.getElementById(id);
  if (!ctx) return;
  if (chartInstances[id]) chartInstances[id].destroy();
  chartInstances[id] = new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label, data,
        borderColor: color,
        backgroundColor: color + '18',
        fill: true,
        tension: 0.4,
        pointBackgroundColor: color,
        pointRadius: 5,
        borderWidth: 2
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { labels: { color: '#8bafc8', font: { family: 'DM Sans' } } } },
      scales: {
        x: { ticks: { color: '#4d7a99', font: {size:11} }, grid: { color:'rgba(0,180,255,0.05)' } },
        y: { min: yMin, max: yMax, ticks: { color: '#4d7a99' }, grid: { color:'rgba(0,180,255,0.05)' } }
      }
    }
  });
}

function renderRiskHistory(id, labels, riskIndices) {
  const ctx = document.getElementById(id);
  if (!ctx) return;
  if (chartInstances[id]) chartInstances[id].destroy();
  const colors = riskIndices.map(r => ['#22c55e','#f59e0b','#f97316','#ef4444'][r]);
  chartInstances[id] = new Chart(ctx, {
    type: 'bar',
    data: {
      labels,
      datasets: [{
        label: 'Risk Level (0=Low, 3=Critical)',
        data: riskIndices,
        backgroundColor: colors,
        borderRadius: 6
      }]
    },
    options: {
      responsive: true,
      plugins: { legend: { labels: { color: '#8bafc8' } } },
      scales: {
        x: { ticks: { color:'#4d7a99', font:{size:11} }, grid:{color:'rgba(0,180,255,0.05)'} },
        y: { min:0, max:3, ticks:{ color:'#4d7a99', callback: v=>['Low','Mod','High','Crit'][v]||v }, grid:{color:'rgba(0,180,255,0.05)'} }
      }
    }
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ALERTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadAlerts() {
  const el = document.getElementById('alerts-list');
  try {
    const res = await fetch(`${API}/alerts`);
    const alerts = await res.json();
    if (!alerts.length) {
      el.innerHTML = `<div style="text-align:center;padding:48px;color:var(--text3)">âœ… No active alerts</div>`;
      return;
    }
    el.innerHTML = alerts.reverse().map(a => `
      <div class="alert-item ${a.type}" style="margin-bottom:12px">
        <span class="alert-icon">ğŸš¨</span>
        <div>
          <strong style="font-size:14px">${a.type.replace('_',' ')}</strong>
          <p class="text-sm">${a.message}</p>
          <p class="text-sm" style="margin-top:4px;color:var(--text3)">${new Date(a.timestamp).toLocaleString()}</p>
        </div>
      </div>`).join('');
  } catch(e) {
    el.innerHTML = `
      <div class="alert-item CRITICAL"><span class="alert-icon">ğŸš¨</span><div><strong>Demo Alert</strong><p class="text-sm">Patient John D. â€” Critical risk detected. Immediate attention needed.</p></div></div>
      <div class="alert-item ESCALATION"><span class="alert-icon">âš ï¸</span><div><strong>Pain Escalation</strong><p class="text-sm">Patient Sarah M. â€” 3-day pain escalation detected.</p></div></div>`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.addEventListener('load', () => {
  // Pre-fill last patient ID
  const lastId = localStorage.getItem('lastPatientId');
  if (lastId) {
    document.getElementById('track-pid').value = lastId;
    document.getElementById('dash-pid').value = lastId;
  }
  // Set today as default surgery date
  document.getElementById('reg-date').value = new Date().toISOString().split('T')[0];
  // Init reveal
  setTimeout(initScrollReveal, 300);
});
</script>
<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     AI FEATURES PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="page-aifeatures" class="page">
  <div class="section">
    <div class="section-header reveal">
      <span class="section-tag">âœ¨ AI Intelligence</span>
      <h2 class="section-title">Advanced AI Insights</h2>
      <p class="section-sub">Deep analysis powered by AI â€” recovery prediction, complication risk, pain patterns & daily tips.</p>
    </div>

    <div style="display:flex;gap:12px;margin-bottom:32px" class="reveal">
      <input type="text" id="ai-pid" placeholder="Enter Patient ID" style="max-width:300px">
      <button class="btn-primary" onclick="loadAIFeatures()">ğŸ§  Analyze â†’</button>
    </div>

    <div id="ai-content" style="display:none">

      <!-- Row 1: Recovery Prediction + Complication Risk -->
      <div class="grid-2" style="margin-bottom:24px">

        <!-- Recovery Prediction -->
        <div class="card reveal from-left" id="recovery-pred-card">
          <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px">
            <div style="width:42px;height:42px;border-radius:10px;background:rgba(0,180,255,0.15);display:flex;align-items:center;justify-content:center;font-size:20px">ğŸ“…</div>
            <div>
              <div class="font-display" style="font-size:18px">Recovery Prediction</div>
              <div class="text-sm">AI-estimated healing timeline</div>
            </div>
          </div>

          <div style="display:flex;align-items:center;gap:24px;margin-bottom:20px">
            <div style="text-align:center">
              <div class="font-display" style="font-size:48px;color:var(--accent)" id="days-remaining">â€”</div>
              <div class="text-sm">Days Remaining</div>
            </div>
            <div style="flex:1">
              <div class="flex-between text-sm" style="margin-bottom:6px">
                <span>Recovery Progress</span>
                <span id="prog-pct" style="color:var(--accent2)">â€”</span>
              </div>
              <div style="height:10px;background:var(--surface2);border-radius:100px;overflow:hidden">
                <div id="prog-bar" style="height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:100px;transition:width 1.2s ease"></div>
              </div>
              <div class="text-sm" style="margin-top:8px" id="milestone-txt">â€”</div>
            </div>
          </div>

          <div style="padding:12px 16px;background:var(--bg3);border-radius:var(--radius-sm);border:1px solid var(--border)">
            <div class="text-sm">ğŸ—“ï¸ Expected Full Recovery: <span id="recovery-date" style="color:var(--accent2);font-weight:600">â€”</span></div>
            <div class="text-sm" style="margin-top:4px">ğŸ“Š Total Estimated Days: <span id="total-days" style="color:var(--accent)">â€”</span></div>
          </div>
        </div>

        <!-- Complication Risk -->
        <div class="card reveal from-right" id="comp-risk-card">
          <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px">
            <div style="width:42px;height:42px;border-radius:10px;background:rgba(239,68,68,0.15);display:flex;align-items:center;justify-content:center;font-size:20px">âš¡</div>
            <div>
              <div class="font-display" style="font-size:18px">Complication Probability</div>
              <div class="text-sm">Next 48-hour risk assessment</div>
            </div>
          </div>

          <div style="text-align:center;margin-bottom:20px">
            <div class="font-display" style="font-size:64px;margin-bottom:4px" id="comp-pct">â€”</div>
            <div id="comp-category" style="font-size:16px;font-weight:600">â€”</div>
          </div>

          <!-- Gauge bar -->
          <div style="height:12px;background:linear-gradient(90deg,#22c55e,#f59e0b,#f97316,#ef4444);border-radius:100px;position:relative;margin-bottom:8px">
            <div id="comp-needle" style="position:absolute;top:-4px;width:4px;height:20px;background:white;border-radius:2px;transform:translateX(-50%);transition:left 1s ease;left:0%"></div>
          </div>
          <div style="display:flex;justify-content:space-between" class="text-sm">
            <span style="color:var(--low)">Safe</span>
            <span style="color:var(--critical)">Critical</span>
          </div>

          <div style="margin-top:16px;padding:12px 16px;border-radius:var(--radius-sm);border:1px solid var(--border);background:var(--bg3)" id="comp-advice">â€”</div>
        </div>
      </div>

      <!-- Row 2: Pain Pattern + Daily Tip -->
      <div class="grid-2">

        <!-- Pain Pattern -->
        <div class="card reveal from-left" id="pain-pattern-card">
          <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px">
            <div style="width:42px;height:42px;border-radius:10px;background:rgba(245,158,11,0.15);display:flex;align-items:center;justify-content:center;font-size:20px">ã€°ï¸</div>
            <div>
              <div class="font-display" style="font-size:18px">Pain Pattern Analysis</div>
              <div class="text-sm">7-day pain trend intelligence</div>
            </div>
          </div>

          <div style="display:flex;align-items:center;gap:16px;margin-bottom:16px">
            <div style="font-size:40px" id="pattern-icon">â€”</div>
            <div>
              <div class="font-display" style="font-size:22px" id="pattern-name">â€”</div>
              <div class="text-sm" id="pattern-desc">â€”</div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="grid-3" style="text-align:center;gap:12px;margin-bottom:16px">
            <div>
              <div class="font-display" style="font-size:28px;color:var(--high)" id="peak-score">â€”</div>
              <div class="text-sm">Peak Pain</div>
            </div>
            <div>
              <div class="font-display" style="font-size:28px;color:var(--accent)" id="avg-score">â€”</div>
              <div class="text-sm">Average</div>
            </div>
            <div>
              <div class="font-display" style="font-size:28px;color:var(--low)" id="best-score">â€”</div>
              <div class="text-sm">Best Day</div>
            </div>
          </div>

          <div style="padding:12px 16px;border-radius:var(--radius-sm);background:rgba(0,180,255,0.05);border:1px solid rgba(0,180,255,0.15)">
            <div class="text-sm">ğŸ’¡ <span id="pattern-rec">â€”</span></div>
          </div>
        </div>

        <!-- Daily Health Tip -->
        <div class="card reveal from-right" id="daily-tip-card" style="background:linear-gradient(135deg,rgba(0,255,198,0.05),rgba(0,180,255,0.05));border-color:rgba(0,255,198,0.2)">
          <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px">
            <div style="width:42px;height:42px;border-radius:10px;background:rgba(0,255,198,0.15);display:flex;align-items:center;justify-content:center;font-size:20px">ğŸ’¡</div>
            <div>
              <div class="font-display" style="font-size:18px">Today's AI Health Tip</div>
              <div class="text-sm" id="tip-day">Day â€” of recovery</div>
            </div>
          </div>

          <div style="text-align:center;font-size:56px;margin-bottom:16px" id="tip-icon">ğŸ’¡</div>

          <div class="font-display" style="font-size:22px;margin-bottom:12px;color:var(--accent2)" id="tip-title">â€”</div>

          <div style="font-size:15px;color:var(--light);line-height:1.7;margin-bottom:16px" id="tip-content">â€”</div>

          <div id="tip-urgency" style="display:none;padding:10px 14px;background:rgba(249,115,22,0.1);border:1px solid rgba(249,115,22,0.3);border-radius:var(--radius-sm);font-size:13px;color:var(--high)"></div>

          <div class="divider"></div>
          <div class="text-sm" style="color:var(--text3);text-align:center">Tip rotates daily based on your recovery phase</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AI FEATURES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadAIFeatures() {
  const pid = document.getElementById('ai-pid').value.trim();
  if (!pid) { toast('Patient ID daalo', 'error'); return; }

  try {
    const res = await fetch(`${API}/ai/full-analysis/${pid}`);
    const data = await res.json();
    renderAIFeatures(data);
    toast('âœ… AI Analysis complete!', 'success');
  } catch(e) {
    // Demo mode
    renderAIFeatures(demoAIData());
    toast('âš¡ Demo mode â€” sample AI analysis', 'info');
  }

  document.getElementById('ai-content').style.display = 'block';
  setTimeout(initScrollReveal, 100);
  document.getElementById('ai-content').scrollIntoView({behavior:'smooth'});
}

function demoAIData() {
  return {
    recovery_prediction: {
      estimated_total_days: 45,
      days_completed: 12,
      days_remaining: 33,
      progress_pct: 26.7,
      milestone: "ğŸŒ± Early recovery â€” stay consistent!",
      expected_recovery_date: "March 31, 2025"
    },
    complication_risk: {
      probability: 38,
      category: "Low",
      color: "#86efac",
      advice: "Minor concerns detected. Follow your rehab plan carefully.",
      next_48hr_risk: "38% chance of complication in next 48 hours"
    },
    pain_pattern: {
      pattern: "Steady Improvement",
      trend: "improving",
      icon: "ğŸ“‰",
      color: "#22c55e",
      description: "Your pain has decreased by 2.5 points. Excellent recovery progress!",
      recommendation: "Continue your current rehab plan. You're on the right track.",
      average: 5.2,
      peak_score: 8,
      best_score: 3,
      trend_change: -2.5
    },
    daily_tip: {
      icon: "â„ï¸",
      title: "Ice Therapy",
      content: "Apply ice pack for 20 minutes every 2 hours on swollen areas. Never apply directly on skin â€” use a cloth.",
      urgency_note: "",
      day_number: 12
    }
  };
}

function renderAIFeatures(data) {
  const { recovery_prediction: rp, complication_risk: cr, pain_pattern: pp, daily_tip: dt } = data;

  // â”€â”€ Recovery Prediction â”€â”€
  document.getElementById('days-remaining').textContent = rp.days_remaining;
  document.getElementById('prog-pct').textContent = rp.progress_pct + '%';
  document.getElementById('prog-bar').style.width = rp.progress_pct + '%';
  document.getElementById('milestone-txt').textContent = rp.milestone;
  document.getElementById('recovery-date').textContent = rp.expected_recovery_date;
  document.getElementById('total-days').textContent = rp.estimated_total_days + ' days';

  // â”€â”€ Complication Risk â”€â”€
  document.getElementById('comp-pct').textContent = Math.round(cr.probability) + '%';
  document.getElementById('comp-pct').style.color = cr.color;
  document.getElementById('comp-category').textContent = cr.category + ' Risk';
  document.getElementById('comp-category').style.color = cr.color;
  document.getElementById('comp-needle').style.left = cr.probability + '%';
  document.getElementById('comp-advice').textContent = cr.advice;
  document.getElementById('comp-advice').style.color = cr.color;

  // â”€â”€ Pain Pattern â”€â”€
  document.getElementById('pattern-icon').textContent = pp.icon;
  document.getElementById('pattern-name').textContent = pp.pattern;
  document.getElementById('pattern-name').style.color = pp.color;
  document.getElementById('pattern-desc').textContent = pp.description;
  document.getElementById('peak-score').textContent = pp.peak_score ?? 'â€”';
  document.getElementById('avg-score').textContent = pp.average ?? 'â€”';
  document.getElementById('best-score').textContent = pp.best_score ?? 'â€”';
  document.getElementById('pattern-rec').textContent = pp.recommendation;

  // â”€â”€ Daily Tip â”€â”€
  document.getElementById('tip-icon').textContent = dt.icon;
  document.getElementById('tip-title').textContent = dt.title;
  document.getElementById('tip-content').textContent = dt.content;
  document.getElementById('tip-day').textContent = `Day ${dt.day_number} of recovery`;
  const urgencyEl = document.getElementById('tip-urgency');
  if (dt.urgency_note) {
    urgencyEl.style.display = 'block';
    urgencyEl.textContent = dt.urgency_note;
  }
}
</script>
</body>
</html>